<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Parent Card</title>
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script>
        var t = TrelloPowerUp.iframe();

        t.get('board', 'shared', 'epicsListId').then(function(epicsListId) {
            return t.cards('id', 'name', 'idList').then(function(cards) {
                var epicsCards = cards.filter(card => card.idList === epicsListId);
                var select = document.getElementById("parentCardSelect");
                epicsCards.forEach(card => {
                    var option = document.createElement("option");
                    option.value = card.id;
                    option.text = card.name;
                    select.add(option);
                });
            });
        });

        function saveParent() {
            var select = document.getElementById("parentCardSelect");
            var parentId = select.value;
            var parentName = select.options[select.selectedIndex].text;
            t.set('card', 'shared', {
                parentCardId: parentId,
                parentCardName: parentName
            }).then(() => {
                t.closePopup();
            });
        }

        function removeParent() {
            t.remove('card', 'shared', ['parentCardId', 'parentCardName']).then(() => {
                t.closePopup();
            });
        }
    </script>
</head>
<body>
    <h2>Set Parent Card</h2>
    <select id="parentCardSelect">
        <option value="">Select Parent Card</option>
    </select>
    <button onclick="saveParent()">Save</button>
    <button onclick="removeParent()">Remove</button>
</body>
</html>